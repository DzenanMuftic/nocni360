{% extends "admin_base.html" %}

{% block title %}Admin Dashboard - Modern360{% endblock %}

{% macro stat_card(icon, color, value, label) -%}
<div class="col">
<div class="card stat-card h-100">
<div class="card-body p-3 text-center">
<i class="fas fa-{{ icon }} fa-lg text-{{ color }} mb-2"></i>
<h4 class="mb-0">{{ value }}</h4>
<small class="text-muted">{{ label }}</small>
</div>
</div>
</div>
{%- endmacro %}

{% macro activity_item(icon_class, bg_color, title, subtitle, badge_text, badge_color) -%}
<div class="d-flex align-items-center mb-2 pb-2 border-bottom">
<div class="bg-{{ bg_color }} rounded-circle p-2 me-2" style="width:32px;height:32px;display:flex;align-items:center;justify-content:center">
<i class="fas fa-{{ icon_class }} text-white" style="font-size:14px"></i>
</div>
<div class="flex-grow-1 overflow-hidden">
<div class="mb-0 fw-bold" style="font-size:13px">{{ title }}</div>
<small class="text-muted" style="font-size:11px">{{ subtitle|safe }}</small>
</div>
{% if badge_text %}<span class="badge bg-{{ badge_color }}" style="font-size:10px">{{ badge_text }}</span>{% endif %}
</div>
{%- endmacro %}

{% macro recent_card(title, icon, url, items, empty_msg) -%}
<div class="card h-100">
<div class="card-header py-2 d-flex justify-content-between align-items-center">
<h6 class="mb-0"><i class="fas fa-{{ icon }} me-1"></i>{{ title }}</h6>
<a href="{{ url }}" class="btn btn-light btn-sm py-0 px-2" style="font-size:11px">View All</a>
</div>
<div class="card-body p-2">
{% if items %}{{ caller(items) }}{% else %}<p class="text-muted text-center mb-0" style="font-size:12px">{{ empty_msg }}</p>{% endif %}
</div>
</div>
{%- endmacro %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
<h1 class="h3 mb-0"><i class="fas fa-tachometer-alt me-2 text-primary"></i>Dashboard</h1>
<span class="badge bg-success"><i class="fas fa-circle me-1" style="font-size:8px"></i>Online</span>
</div>

<!-- Statistics Cards -->
<div class="row row-cols-auto g-2 mb-3">
{{ stat_card('building', 'primary', total_companies, 'Companies') }}
{{ stat_card('users', 'info', total_users, 'Users') }}
{{ stat_card('clipboard-list', 'success', total_assessments, 'Assessments') }}
{{ stat_card('play-circle', 'warning', active_assessments, 'Active') }}
{{ stat_card('check-circle', 'success', total_responses, 'Responses') }}
{{ stat_card('envelope', 'warning', pending_invitations, 'Pending') }}
</div>

<!-- Quick Actions -->
<div class="row g-2 mb-3">
<div class="col-md-3"><a href="{{ url_for('admin_create_company') }}" class="btn btn-primary w-100 py-2"><i class="fas fa-plus me-1"></i>New Company</a></div>
<div class="col-md-3"><a href="{{ url_for('admin_create_assessment') }}" class="btn btn-success w-100 py-2"><i class="fas fa-clipboard-list me-1"></i>New Assessment</a></div>
<div class="col-md-3"><a href="{{ url_for('admin_create_user') }}" class="btn btn-info w-100 py-2"><i class="fas fa-user-plus me-1"></i>Add User</a></div>
<div class="col-md-3"><a href="{{ url_for('admin_notifications') }}" class="btn btn-warning w-100 py-2"><i class="fas fa-bell me-1"></i>Notifications</a></div>
</div>

<!-- Recent Activity -->
<div class="row g-2">
<div class="col-md-3">
{% call recent_card('Companies', 'building', url_for('admin_companies'), recent_companies, 'No companies') %}
{% for company in recent_companies %}
{{ activity_item('building', 'primary', company.name, company.users|length ~ ' users, ' ~ company.assessments|length ~ ' assessments', 'Active' if company.is_active else 'Inactive', 'success' if company.is_active else 'secondary') }}
{% endfor %}
{% endcall %}
</div>

<div class="col-md-3">
{% call recent_card('Users', 'users', url_for('admin_users'), recent_users, 'No users') %}
{% for user in recent_users %}
{{ activity_item('user', 'info', user.name, user.email, user.role.title(), 'success' if user.is_active else 'secondary') }}
{% endfor %}
{% endcall %}
</div>

<div class="col-md-3">
{% call recent_card('Assessments', 'clipboard-list', url_for('admin_assessments'), recent_assessments, 'No assessments') %}
{% for assessment in recent_assessments %}
{{ activity_item('clipboard-list', 'success', assessment.title[:25] ~ ('...' if assessment.title|length > 25 else ''), assessment.created_at.strftime('%m/%d/%Y'), 'Active' if assessment.is_active else 'Inactive', 'success' if assessment.is_active else 'secondary') }}
{% endfor %}
{% endcall %}
</div>

<div class="col-md-3">
{% call recent_card('Activity', 'chart-bar', url_for('admin_reports'), recent_responses, 'No responses') %}
{% for response in recent_responses %}
{{ activity_item('check', 'info', 'Response', response.submitted_at.strftime('%m/%d %H:%M'), 'Done', 'info') }}
{% endfor %}
{% endcall %}
</div>
</div>
{% endblock %}
