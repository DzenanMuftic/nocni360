{% extends "admin_base.html" %}

{% block title %}Admin Dashboard - Modern360{% endblock %}

{% macro stat_card(icon, color, value, label) -%}
<div class="col-md-2">
<div class="card stat-card h-100">
<div class="card-body text-center">
<i class="fas fa-{{ icon }} fa-2x text-{{ color }} mb-2"></i>
<h3 class="mb-1">{{ value }}</h3>
<p class="text-muted mb-0">{{ label }}</p>
</div>
</div>
</div>
{%- endmacro %}

{% macro activity_item(icon_class, bg_color, title, subtitle, badge_text, badge_color) -%}
<div class="d-flex align-items-center mb-3">
<div class="bg-{{ bg_color }} rounded-circle p-2 me-3">
<i class="fas fa-{{ icon_class }} text-white"></i>
</div>
<div class="flex-grow-1">
<h6 class="mb-0">{{ title }}</h6>
<small class="text-muted">{{ subtitle|safe }}</small>
</div>
{% if badge_text %}<span class="badge bg-{{ badge_color }}">{{ badge_text }}</span>{% endif %}
</div>
{%- endmacro %}

{% macro recent_card(title, icon, url, items, empty_msg) -%}
<div class="card">
<div class="card-header d-flex justify-content-between align-items-center">
<h5 class="mb-0"><i class="fas fa-{{ icon }} me-2"></i>{{ title }}</h5>
<a href="{{ url }}" class="btn btn-light btn-sm">View All</a>
</div>
<div class="card-body">
{% if items %}{{ caller(items) }}{% else %}<p class="text-muted text-center">{{ empty_msg }}</p>{% endif %}
</div>
</div>
{%- endmacro %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
<h1 class="h2 mb-0"><i class="fas fa-tachometer-alt me-2 text-primary"></i>Admin Dashboard</h1>
<span class="badge bg-success fs-6"><i class="fas fa-circle me-1"></i>System Online</span>
</div>

<!-- Statistics Cards -->
<div class="row mb-4">
{{ stat_card('building', 'primary', total_companies, 'Companies') }}
{{ stat_card('users', 'info', total_users, 'Total Users') }}
{{ stat_card('clipboard-list', 'success', total_assessments, 'Assessments') }}
{{ stat_card('play-circle', 'warning', active_assessments, 'Active') }}
{{ stat_card('check-circle', 'success', total_responses, 'Responses') }}
{{ stat_card('envelope', 'warning', pending_invitations, 'Pending') }}
<div class="col-md-2">
<div class="card stat-card h-100">
<div class="card-body text-center">
<a href="{{ url_for('admin_create_company') }}" class="btn btn-primary btn-sm w-100 mb-2"><i class="fas fa-plus me-1"></i>New Company</a>
<a href="{{ url_for('admin_create_assessment') }}" class="btn btn-outline-primary btn-sm w-100 mb-2"><i class="fas fa-clipboard-list me-1"></i>New Assessment</a>
<a href="{{ url_for('admin_create_user') }}" class="btn btn-outline-secondary btn-sm w-100"><i class="fas fa-user-plus me-1"></i>Add User</a>
</div>
</div>
</div>
</div>

<!-- Recent Activity -->
<div class="row">
<div class="col-md-3">
{% call recent_card('Recent Companies', 'building', url_for('admin_companies'), recent_companies, 'No companies found') %}
{% for company in recent_companies %}
{{ activity_item('building', 'primary', company.name, company.users|length ~ ' users, ' ~ company.assessments|length ~ ' assessments', 'Active' if company.is_active else 'Inactive', 'success' if company.is_active else 'secondary') }}
{% endfor %}
{% endcall %}
</div>

<div class="col-md-3">
{% call recent_card('Recent Users', 'users', url_for('admin_users'), recent_users, 'No users found') %}
{% for user in recent_users %}
{{ activity_item('user', 'info', user.name, user.email ~ ('<br><small class="text-primary"><i class="fas fa-building" style="font-size:10px"></i> ' ~ user.company ~ '</small>' if user.company else ''), user.role.title(), 'success' if user.is_active else 'secondary') }}
{% endfor %}
{% endcall %}
</div>

<div class="col-md-4">
{% call recent_card('Recent Assessments', 'clipboard-list', url_for('admin_assessments'), recent_assessments, 'No assessments found') %}
{% for assessment in recent_assessments %}
{{ activity_item('clipboard-list', 'success', assessment.title[:30] ~ ('...' if assessment.title|length > 30 else ''), assessment.created_at.strftime('%m/%d/%Y'), 'Active' if assessment.is_active else 'Inactive', 'success' if assessment.is_active else 'secondary') }}
{% endfor %}
{% endcall %}
</div>

<div class="col-md-4">
{% call recent_card('Recent Activity', 'chart-bar', url_for('admin_reports'), recent_responses, 'No responses yet') %}
{% for response in recent_responses %}
{{ activity_item('check', 'info', 'Assessment Response', response.submitted_at.strftime('%m/%d/%Y %H:%M'), 'Completed', 'info') }}
{% endfor %}
{% endcall %}
</div>
</div>

<!-- Quick Actions -->
<div class="row mt-4">
<div class="col-12">
<div class="card">
<div class="card-header"><h5 class="mb-0"><i class="fas fa-lightning-bolt me-2"></i>Quick Actions</h5></div>
<div class="card-body">
<div class="row">
<div class="col-md-3"><a href="{{ url_for('admin_create_assessment') }}" class="btn btn-primary w-100 mb-2"><i class="fas fa-plus me-2"></i>Create Assessment</a></div>
<div class="col-md-3"><a href="{{ url_for('admin_send_invitations') }}" class="btn btn-success w-100 mb-2"><i class="fas fa-envelope me-2"></i>Send Invitations</a></div>
<div class="col-md-3"><a href="{{ url_for('admin_create_user') }}" class="btn btn-info w-100 mb-2"><i class="fas fa-user-plus me-2"></i>Add User</a></div>
<div class="col-md-3"><a href="{{ url_for('admin_notifications') }}" class="btn btn-warning w-100 mb-2"><i class="fas fa-bell me-2"></i>Notifications</a></div>
</div>
</div>
</div>
</div>
</div>
{% endblock %}
